# æµ‹è¯•ç›®å½•

## ğŸ“ ç›®å½•ç»“æ„

```
tests/
â”œâ”€â”€ __init__.py                      # åŒ…åˆå§‹åŒ–
â”œâ”€â”€ README.md                        # æœ¬æ–‡ä»¶
â”œâ”€â”€ integration/                     # é›†æˆæµ‹è¯•ï¼ˆä½¿ç”¨çœŸå®æ•°æ®åº“ï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py                 # æµ‹è¯•é…ç½®å’Œ fixtures
â”‚   â”œâ”€â”€ test_document_permissions.py # æ–‡æ¡£æƒé™æµ‹è¯•
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ test_ownership_checker.py        # å·¥å…·ç±»ï¼šæƒé™æ£€æŸ¥å™¨æµ‹è¯•
â””â”€â”€ test_resource_helpers.py         # å·¥å…·ç±»ï¼šèµ„æºè¾…åŠ©å‡½æ•°æµ‹è¯•
```

---

## ğŸ¯ æµ‹è¯•åˆ†ç±»

### 1. å•å…ƒæµ‹è¯•ï¼ˆå·¥å…·ç±»ï¼‰âš¡

**æ–‡ä»¶**ï¼š
- `test_ownership_checker.py` - æµ‹è¯•æƒé™æ£€æŸ¥é€»è¾‘
- `test_resource_helpers.py` - æµ‹è¯•èµ„æºè·å–è¾…åŠ©å‡½æ•°

**ç‰¹ç‚¹**ï¼š
- âœ… å¿«é€Ÿï¼ˆä½¿ç”¨ mockï¼‰
- âœ… æµ‹è¯•çº¯é€»è¾‘
- âœ… ä¸ä¾èµ–æ•°æ®åº“

**è¿è¡Œ**ï¼š
```bash
pytest tests/test_ownership_checker.py -v
pytest tests/test_resource_helpers.py -v
```

---

### 2. é›†æˆæµ‹è¯•ï¼ˆçœŸå®ä¸šåŠ¡åœºæ™¯ï¼‰ğŸ”„

**ç›®å½•**ï¼š`integration/`

**æ–‡ä»¶**ï¼š
- `test_document_permissions.py` - æ–‡æ¡£æƒé™å’ŒCRUDæµ‹è¯•

**ç‰¹ç‚¹**ï¼š
- âœ… ä½¿ç”¨çœŸå®æµ‹è¯•æ•°æ®åº“
- âœ… æµ‹è¯•å®Œæ•´ä¸šåŠ¡æµç¨‹
- âœ… ä¸ä½¿ç”¨ mock
- âœ… æµ‹è¯•ç”¨æˆ·æƒé™éš”ç¦»

**è¿è¡Œ**ï¼š
```bash
pytest tests/integration/ -v
```

---

## ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/ -v

# åªè¿è¡Œå•å…ƒæµ‹è¯•
pytest tests/test_*.py -v

# åªè¿è¡Œé›†æˆæµ‹è¯•
pytest tests/integration/ -v

# æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
pytest tests/ -v -s

# åœ¨ç¬¬ä¸€ä¸ªå¤±è´¥æ—¶åœæ­¢
pytest tests/ -v -x
```

---

## ğŸ“Š å½“å‰æµ‹è¯•ç»Ÿè®¡

| ç±»å‹ | æ–‡ä»¶æ•° | æµ‹è¯•æ•° | ç‰¹ç‚¹ |
|------|--------|--------|------|
| å•å…ƒæµ‹è¯• | 2 | 22 | å¿«é€Ÿï¼Œmock |
| é›†æˆæµ‹è¯• | 1 | 9 | çœŸå®DB |
| **æ€»è®¡** | **3** | **31** | - |

---

## âœ… æµ‹è¯•åŸåˆ™

### æˆ‘ä»¬çš„æµ‹è¯•å“²å­¦

1. **çœŸå®åœºæ™¯ä¼˜å…ˆ** - æµ‹è¯•çœŸå®çš„ä¸šåŠ¡åœºæ™¯ï¼Œä¸æ˜¯ä¸ºäº†æµ‹è¯•è€Œæµ‹è¯•
2. **ä¸è¿‡åº¦ä½¿ç”¨ mock** - é›†æˆæµ‹è¯•ä½¿ç”¨çœŸå®æ•°æ®åº“
3. **æµ‹è¯•å…³é”®é€»è¾‘** - é‡ç‚¹æµ‹è¯•æƒé™ã€å®‰å…¨ã€æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
4. **ä¿æŒç®€æ´** - åªä¿ç•™æœ‰ä»·å€¼çš„æµ‹è¯•
5. **å¿«é€Ÿåé¦ˆ** - æµ‹è¯•åº”è¯¥å¿«é€Ÿè¿è¡Œï¼Œæä¾›åŠæ—¶åé¦ˆ

### ä¸è¦åšçš„äº‹

- âŒ ä¸ä¸ºäº†è¦†ç›–ç‡è€Œå†™æ— ç”¨æµ‹è¯•
- âŒ ä¸è¿‡åº¦ mock å¯¼è‡´æµ‹è¯•ä¸çœŸå®
- âŒ ä¸ä¿ç•™æ—§çš„ã€è¿‡æ—¶çš„æµ‹è¯•
- âŒ ä¸å†™å¤ªå¤æ‚çš„æµ‹è¯•ï¼ˆæµ‹è¯•æœ¬èº«è¦ç®€å•ï¼‰

---

## ğŸ“ æ·»åŠ æ–°æµ‹è¯•

### ä½•æ—¶æ·»åŠ å•å…ƒæµ‹è¯•

å½“ä½ åˆ›å»ºæ–°çš„**å·¥å…·ç±»**æˆ–**è¾…åŠ©å‡½æ•°**æ—¶ï¼š

```python
# tests/test_your_utility.py
import pytest
from app.core.your_utility import YourUtility

def test_your_utility_basic_case():
    result = YourUtility.do_something(...)
    assert result == expected
```

### ä½•æ—¶æ·»åŠ é›†æˆæµ‹è¯•

å½“ä½ æ·»åŠ æ¶‰åŠ**æ•°æ®åº“**å’Œ**æƒé™**çš„æ–°åŠŸèƒ½æ—¶ï¼š

```python
# tests/integration/test_your_feature.py
import pytest

@pytest.mark.asyncio
async def test_your_feature_with_permissions(test_db, test_user):
    # æµ‹è¯•å®Œæ•´çš„ä¸šåŠ¡æµç¨‹
    result = await your_api_function(test_db, test_user)
    assert result is not None
```

---

## ğŸ”„ æŒç»­æ”¹è¿›

è¿™ä¸ªæµ‹è¯•å¥—ä»¶ä¼šéšç€é¡¹ç›®å‘å±•è€Œæ¼”è¿›ï¼š

- âœ… é‡æ„åæ·»åŠ æ–°æµ‹è¯•
- âœ… å‘ç° bug æ—¶æ·»åŠ å›å½’æµ‹è¯•
- âœ… åˆ é™¤è¿‡æ—¶çš„æµ‹è¯•
- âœ… ä¿æŒæµ‹è¯•ç®€æ´æœ‰æ•ˆ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é›†æˆæµ‹è¯•è¯´æ˜](integration/README.md)
- [æµ‹è¯•ç­–ç•¥](../docs/refactoring/TESTING_STRATEGY.md)
- [é‡æ„è®¡åˆ’](../docs/refactoring/REFACTORING_PLAN.md)

---

æœ€åæ›´æ–°ï¼š2024-11-15
