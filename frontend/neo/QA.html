<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sortify - Agentic Flow</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <style>
        :root {
            --c-green: #29bf12;
            --c-teal: #08bdbd;
            --c-lime: #abff4f;
            --c-orange: #ff9914;
            --c-black: #000000;
            --c-white: #ffffff;
            --c-bg: #f3f4f6;
            --border-black: 2px solid var(--c-black);
            --shadow-hard: 4px 4px 0px 0px var(--c-black);
        }

        body { font-family: 'Inter', sans-serif; background-color: var(--c-bg); color: var(--c-black); }
        .font-display { font-family: 'Space Grotesk', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* 聊天氣泡容器 */
        .chat-bubble {
            max-width: 90%;
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            animation: fadeIn 0.3s ease-out;
        }
        .chat-bubble.user { flex-direction: row-reverse; margin-left: auto; }
        
        /* 用戶內容 */
        .user-content {
            background: var(--c-black);
            color: white;
            padding: 12px 20px;
            border-radius: 16px 16px 0 16px;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.2);
        }

        /* AI 內容容器 (Neo-Box Style) */
        .ai-container {
            flex: 1;
            background: white;
            border: var(--border-black);
            border-radius: 0 16px 16px 16px;
            box-shadow: var(--shadow-hard);
            overflow: hidden;
        }

        /* 步驟條 (Step Indicator) */
        .step-line {
            position: absolute;
            left: 14px;
            top: 24px;
            bottom: -10px;
            width: 2px;
            background: #e5e7eb;
            z-index: 0;
        }
        .step-item:last-child .step-line { display: none; }

        /* 工具調用區塊 (Process Block) */
        .process-block {
            position: relative;
            padding: 0 0 16px 36px;
        }
        .process-icon {
            position: absolute;
            left: 0;
            top: 0;
            width: 30px;
            height: 30px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            z-index: 1;
            font-size: 14px;
        }
        .process-block.active .process-icon {
            border-color: var(--c-black);
            background: var(--c-lime);
            animation: pulse 2s infinite;
        }
        .process-block.done .process-icon {
            background: var(--c-green);
            border-color: var(--c-black);
            color: var(--c-black);
        }

        /* 摺疊詳情 (Details) */
        details > summary {
            list-style: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        details > summary::-webkit-details-marker { display: none; }
        details[open] > summary { margin-bottom: 8px; }
        
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 12px;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            overflow-x: auto;
            border: 2px solid black;
        }

        /* 引用標籤 */
        .citation {
            display: inline-flex; align-items: center; gap: 4px;
            background: #e5e7eb;
            border: 1px solid black;
            border-radius: 99px;
            padding: 2px 8px;
            font-size: 0.75rem;
            font-weight: bold;
            cursor: pointer;
            margin: 0 2px;
            transition: all 0.1s;
        }
        .citation:hover { background: var(--c-teal); color: white; transform: translateY(-1px); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(171, 255, 79, 0.7); } 70% { box-shadow: 0 0 0 6px rgba(171, 255, 79, 0); } 100% { box-shadow: 0 0 0 0 rgba(171, 255, 79, 0); } }
        
        /* 閃爍游標 */
        .cursor::after { content: '▋'; color: var(--c-green); animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        /* 右側預覽面板動畫 */
        .preview-panel {
            width: 0;
            transition: width 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            border-left: var(--border-black);
            background: white;
            overflow: hidden;
        }
        .preview-panel.open { width: 400px; }

    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <!-- 主對話區 -->
    <main class="flex-1 flex flex-col relative min-w-0">
        
        <!-- Header -->
        <header class="h-16 border-b-[2px] border-black bg-white flex items-center justify-between px-6 z-10">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-black text-white flex items-center justify-center font-display font-bold text-lg rounded">S</div>
                <span class="font-bold text-lg">AI Workspace</span>
                <span class="text-xs bg-gray-100 border border-gray-300 px-2 py-1 rounded text-gray-500 font-mono">Trace ID: #8829A</span>
            </div>
            <div class="flex gap-2">
                <button class="p-2 hover:bg-gray-100 rounded border border-transparent hover:border-black transition-all"><i class="ph-bold ph-clock-counter-clockwise"></i></button>
                <button class="p-2 hover:bg-gray-100 rounded border border-transparent hover:border-black transition-all"><i class="ph-bold ph-share-network"></i></button>
            </div>
        </header>

        <!-- Chat Scroll Area -->
        <div class="flex-1 overflow-y-auto p-6 pb-32 bg-[#f3f4f6]">
            
            <!-- USER MESSAGE -->
            <div class="chat-bubble user">
                <div class="w-10 h-10 bg-black rounded-full border-2 border-black overflow-hidden flex-shrink-0">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="User">
                </div>
                <div class="user-content">
                    <p class="font-medium">請幫我查找「新竹科學園區專案」相關的合約，並總結一下付款條款。</p>
                </div>
            </div>

            <!-- AI MESSAGE (Complex Flow) -->
            <div class="chat-bubble">
                <div class="w-10 h-10 bg-[var(--c-green)] border-2 border-black flex items-center justify-center font-bold text-lg flex-shrink-0 shadow-[2px_2px_0px_black]">AI</div>
                
                <div class="ai-container">
                    <!-- 頂部狀態條 -->
                    <div class="bg-gray-50 border-b-2 border-black px-4 py-2 flex items-center gap-2 text-xs font-bold text-gray-500 uppercase">
                        <i class="ph-fill ph-brain text-[var(--c-teal)]"></i>
                        <span>Reasoning Chain</span>
                        <span class="ml-auto font-mono">3.2s</span>
                    </div>

                    <div class="p-6">
                        
                        <!-- STEP 1: Thought (Completed) -->
                        <div class="process-block done step-item">
                            <div class="step-line"></div>
                            <div class="process-icon"><i class="ph-bold ph-check"></i></div>
                            <div class="text-sm text-gray-500 mb-1 font-mono text-xs">THOUGHT</div>
                            <p class="text-sm font-bold">分析用戶意圖：搜索特定專案合約 + 提取條款。</p>
                        </div>

                        <!-- STEP 2: Tool Call (Completed with details) -->
                        <div class="process-block done step-item">
                            <div class="step-line"></div>
                            <div class="process-icon"><i class="ph-bold ph-wrench"></i></div>
                            <details>
                                <summary class="hover:text-[var(--c-teal)] transition-colors">
                                    <span>調用工具: <span class="font-mono bg-gray-100 px-1 rounded">vector_search</span></span>
                                    <span class="text-[10px] border border-black px-1 rounded bg-[var(--c-green)] text-black ml-auto">SUCCESS</span>
                                </summary>
                                <div class="mt-2">
                                    <div class="code-block">
{
  "tool": "vector_search",
  "params": {
    "query": "新竹科學園區專案 合約",
    "filter": { "type": "contract" },
    "top_k": 3
  }
}
                                    </div>
                                    <div class="mt-2 text-xs text-gray-500">
                                        <i class="ph-bold ph-arrow-return-right"></i> 返回 3 個結果，相關度最高 0.89
                                    </div>
                                </div>
                            </details>
                        </div>

                        <!-- STEP 3: Human Approval (The "Halt" State) -->
                        <div class="process-block active step-item">
                            <div class="step-line"></div>
                            <div class="process-icon"><i class="ph-bold ph-hand-palm"></i></div>
                            
                            <div class="bg-[#fff7ed] border-2 border-[var(--c-orange)] p-4 rounded-lg relative overflow-hidden">
                                <div class="absolute top-0 left-0 w-1 h-full bg-[var(--c-orange)]"></div>
                                <h4 class="font-bold text-[var(--c-orange)] text-sm flex items-center gap-2 mb-2">
                                    <i class="ph-fill ph-lock-key"></i> 需要權限批准
                                </h4>
                                <p class="text-sm text-gray-800 mb-3">
                                    搜尋結果包含一份標記為 <strong>機密 (Confidential)</strong> 的文件：
                                    <br>
                                    <span class="font-mono text-xs bg-white border border-gray-300 px-1 rounded mt-1 inline-block">2024_Hsinchu_Project_NDA_Signed.pdf</span>
                                </p>
                                <div class="flex gap-3">
                                    <button class="bg-[var(--c-green)] text-black border border-black px-4 py-1.5 text-xs font-bold shadow-[2px_2px_0px_black] hover:translate-y-0.5 hover:shadow-none transition-all">
                                        允許讀取
                                    </button>
                                    <button class="bg-white text-gray-500 border border-gray-300 px-4 py-1.5 text-xs font-bold hover:bg-gray-100 hover:text-black hover:border-black">
                                        跳過此文件
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- STEP 4: Final Response (Streaming...) -->
                        <div class="process-block step-item mt-4">
                            <div class="process-icon" style="border-style: dashed;"><i class="ph-bold ph-text-t"></i></div>
                            <div class="text-sm text-gray-500 mb-2 font-mono text-xs uppercase tracking-wider">Generating Response...</div>
                            
                            <div class="prose prose-sm max-w-none text-gray-800 leading-relaxed">
                                <p>
                                    根據檢索到的 <span class="citation" onclick="openPreview(1)">主合約文檔</span>，關於新竹科學園區專案的付款條款總結如下：
                                </p>
                                <ul class="list-disc pl-5 space-y-1 mt-2">
                                    <li>
                                        <strong>預付款：</strong> 簽約後 10 日內支付總金額的 <span class="bg-[var(--c-lime)] px-1 border-b-2 border-black">30%</span>。
                                    </li>
                                    <li>
                                        <strong>進度款：</strong> 第一階段驗收通過後，支付 40%。
                                    </li>
                                    <li>
                                        <strong>尾款：</strong> 專案結案後支付剩餘 30%，保留款 5% 於保固期滿後退還。
                                    </li>
                                </ul>
                                <p class="mt-3">
                                    另外，根據 <span class="citation" onclick="openPreview(2)">附件三：罰則</span>，若延遲交付，每日罰款為合約總額的 0.1%。<span class="cursor"></span>
                                </p>
                            </div>

                            <!-- 快捷後續操作 -->
                            <div class="flex gap-2 mt-6">
                                <button class="text-xs flex items-center gap-1 bg-gray-100 border border-gray-300 px-3 py-1.5 rounded hover:border-[var(--c-teal)] hover:text-[var(--c-teal)] transition-colors">
                                    <i class="ph-bold ph-file-pdf"></i> 生成 PDF 報告
                                </button>
                                <button class="text-xs flex items-center gap-1 bg-gray-100 border border-gray-300 px-3 py-1.5 rounded hover:border-[var(--c-teal)] hover:text-[var(--c-teal)] transition-colors">
                                    <i class="ph-bold ph-envelope-simple"></i> 寄給財務部
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

        </div>

        <!-- Input Area (Cockpit) -->
        <div class="absolute bottom-6 left-1/2 transform -translate-x-1/2 w-full max-w-3xl px-4 z-20">
            <div class="bg-white border-[2px] border-black p-2 shadow-[8px_8px_0px_rgba(0,0,0,0.2)] rounded-xl flex flex-col gap-2 transition-all focus-within:shadow-[8px_8px_0px_var(--c-lime)]">
                
                <!-- Context Chips (Currently Active) -->
                <div class="flex gap-2 px-2 pt-1">
                    <div class="flex items-center gap-1 text-[10px] font-bold bg-[var(--c-teal)] text-white px-2 py-0.5 rounded border border-black">
                        <i class="ph-bold ph-database"></i> MongoDB: sortify_main
                    </div>
                    <div class="flex items-center gap-1 text-[10px] font-bold bg-gray-100 text-gray-600 px-2 py-0.5 rounded border border-gray-300">
                        <i class="ph-bold ph-globe"></i> Web Search: OFF
                    </div>
                </div>

                <div class="flex items-end gap-2">
                    <button class="p-2 text-gray-400 hover:text-black transition-colors rounded-lg hover:bg-gray-100">
                        <i class="ph-bold ph-plus-circle text-2xl"></i>
                    </button>
                    <textarea class="w-full max-h-32 bg-transparent border-none outline-none text-lg p-2 resize-none placeholder-gray-400 font-medium" rows="1" placeholder="Ask AI anything... (Type @ to tag files)"></textarea>
                    <button class="p-3 bg-black text-white rounded-lg hover:bg-[var(--c-green)] hover:text-black transition-colors shadow-md">
                        <i class="ph-bold ph-paper-plane-right text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="text-center mt-2">
                <p class="text-[10px] text-gray-500 font-bold font-mono bg-white/80 inline-block px-2 rounded">Sortify AI can verify data against 14,205 documents.</p>
            </div>
        </div>

    </main>

    <!-- 右側：智能預覽面板 (Side Panel) -->
    <aside class="preview-panel border-l-[3px] border-black flex flex-col" id="side-panel">
        <div class="h-16 border-b-[2px] border-black flex items-center justify-between px-4 bg-gray-50">
            <div class="flex items-center gap-2">
                <div class="w-1 h-6 bg-[var(--c-teal)]"></div>
                <span class="font-bold uppercase text-sm">Source Preview</span>
            </div>
            <button class="p-2 hover:bg-gray-200 rounded" onclick="closePreview()">
                <i class="ph-bold ph-x"></i>
            </button>
        </div>

        <div class="flex-1 overflow-y-auto p-4">
            <!-- 文件卡片 -->
            <div class="border-2 border-black bg-white mb-4 shadow-[4px_4px_0px_rgba(0,0,0,0.1)]">
                <div class="bg-black text-white px-3 py-2 text-xs font-bold flex justify-between items-center">
                    <span class="flex items-center gap-2"><i class="ph-fill ph-file-pdf"></i> Contract_v2.pdf</span>
                    <span class="bg-[var(--c-teal)] px-1 text-black">Pg. 4</span>
                </div>
                <div class="p-4 text-sm text-gray-600 font-mono leading-relaxed">
                    <div class="mb-2 text-xs text-gray-400">...context match...</div>
                    <p class="bg-yellow-100 border-l-4 border-yellow-400 pl-2 py-1">
                        3.1 付款條款：本合約簽署後十日內，甲方應支付乙方總價金之30%作為預付款。
                    </p>
                    <p class="mt-2">
                        3.2 第一階段里程碑驗收完成後，支付40%。
                    </p>
                </div>
                <div class="border-t-2 border-gray-100 p-2 flex justify-end">
                    <button class="text-xs font-bold text-[var(--c-teal)] hover:underline flex items-center gap-1">
                        Open File <i class="ph-bold ph-arrow-square-out"></i>
                    </button>
                </div>
            </div>

             <!-- 另一個引用 -->
             <div class="border-2 border-black bg-white mb-4 opacity-60 hover:opacity-100 transition-opacity">
                <div class="bg-gray-100 text-black px-3 py-2 text-xs font-bold flex justify-between items-center border-b-2 border-black">
                    <span class="flex items-center gap-2"><i class="ph-fill ph-file-text"></i> Penalty_Rules.docx</span>
                    <span>Pg. 1</span>
                </div>
                <div class="p-4 text-sm text-gray-600 font-mono leading-relaxed">
                    <p>延遲罰則：每逾期一日，罰款總額 0.1%。</p>
                </div>
            </div>
        </div>
    </aside>

    <script>
        function openPreview(id) {
            document.getElementById('side-panel').classList.add('open');
        }
        function closePreview() {
            document.getElementById('side-panel').classList.remove('open');
        }
    </script>

</body>
</html>